#!/bin/bash

source bin/conf
source bin/libs/inputs
source bin/libs/os

manage.install() {
    while true;
    do
        CHOICES=(
            "All dependencies and packaging"
            "API's dependencies in Python virtual environment"
            "UI's dependencies (Node.js modules)"
        )

        VALUES=(
            all
            api
            ui
        )

        args.pull OPERATION
        inputs.choices OPERATION "Install Module" "Choose module to install" "all" "$OPERATION" "${CHOICES[@]}" "${VALUES[@]}"

        if [[ $OPERATION == "all" ]]; then
            manage.install.api
            manage.install.ui
        elif [[ $OPERATION == "api" ]]; then
            manage.install.api
        elif [[ $OPERATION == "ui" ]]; then
            manage.install.ui
        elif [[ $OPERATION == "cancel" ]]; then
            return
        fi
    done
}

manage.install.api() {
    echo "[UWKGM: INFO] Installing dependencies..."
    python3 -m pip install --upgrade pip
    python3 -m pip install -r api/requirements.txt
    echo "[UWKGM: INFO] API's dependency installation completed."
    echo ""
}

manage.install.ui() {
    npm install --unsafe-perm=true --allow-root --prefix "ui/uwkgm"
    echo "[UWKGM: INFO] UI's dependency installation completed. Running 'npm audit fix'..."

    npm audit fix --prefix "ui/uwkgm"
    echo "[UWKGM: INFO] UI's audit and fix completed."
    echo ""
}