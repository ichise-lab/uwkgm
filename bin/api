#!/bin/bash

if [[ $2 == install && $3 == venv ]]; then
    python3 -m venv $UWKGM_BASE_DIR/api/env
    source $UWKGM_BASE_DIR/api/env/bin/activate
    pip install -r $UWKGM_BASE_DIR/api/requirements.txt

elif [[ $2 == serve ]]; then
    source $UWKGM_BASE_DIR/api/env/bin/activate

    echo "Preparing the API server..."
    export UWKGM_API_STATE=migrating
    python3 $UWKGM_BASE_DIR/api/uwkgm/manage.py makemigrations accounts
    python3 $UWKGM_BASE_DIR/api/uwkgm/manage.py makemigrations
    python3 $UWKGM_BASE_DIR/api/uwkgm/manage.py migrate

    echo "Preparing the API server..."
    export UWKGM_API_STATE=running
    python3 $UWKGM_BASE_DIR/api/uwkgm/manage.py runserver $UWKGM_API_HOST:$UWKGM_API_PORT
fi
