#!/bin/bash

args.auto() {
    if [[ ${#UWKGM_ARGS[@]} -ge 1 ]]; then
        UWKGM_INTERACTIVE=false
    else
        UWKGM_INTERACTIVE=true
    fi
}

args.parse() {
    UWKGM_ARGS=()
    UWKGM_KWARGS=()

    TMP_ARGS=("$@")

    if [[ ${#TMP_ARGS[@]} -ge 1 ]]; then
        IS_KWARGS=false

        for i in $(seq 0 $((${#TMP_ARGS[@]} - 1)));
        do
            if [[ ${TMP_ARGS[i]} == "-"* ]]; then
                IS_KWARGS=true
            fi

            if [[ $IS_KWARGS == true ]]; then
                UWKGM_KWARGS+=("${TMP_ARGS[i]}")
            else
                UWKGM_ARGS+=("${TMP_ARGS[i]}")
            fi
        done
    fi
}

args.shift() {
    if [[ ${#UWKGM_ARGS[@]} -ge 2 ]]; then
        TMP_ARGS=()

        for i in $(seq 1 $((${#UWKGM_ARGS[@]} - 1)));
        do
            TMP_ARGS+=("${UWKGM_ARGS[i]}")
        done

        UWKGM_ARGS=("${TMP_ARGS[@]}")
    else
        UWKGM_ARGS=()
    fi
}

args.pull() {
    if [[ $UWKGM_INTERACTIVE == false ]]; then
        if [[ ${#UWKGM_ARGS[@]} == 0 ]]; then
            exit 0
        else
            eval "$1=${UWKGM_ARGS[0]}"
            args.shift
        fi
    else
        eval "$1="
    fi
}

args.kwargs.get() {
    IS_FOUND=false
    IFS='|' read -r -a KWARG_KEY <<< "$2"

    if [[ ${#UWKGM_KWARGS[@]} -ge 1 ]]; then
        for i in $(seq 0 $((${#UWKGM_KWARGS[@]} - 1)));
        do
            if [[ ${UWKGM_KWARGS[i]} == "$KWARG_KEY" ]]; then
                eval "$1=true"
            elif [[ ${UWKGM_KWARGS[i]} == "$KWARG_KEY="* ]]; then
                eval "$1=${UWKGM_KWARGS[i]:${#KWARG_KEY} + 1}"
            fi
        done
    fi
}

args.kwargs.parse() {
    KWARG_ARRAY=("$@")
    KWARG_VARS=()
    KWARG_KEYS=()

    for i in $(seq 0 $((${#KWARG_ARRAY[@]} / 2 - 1)));
    do
        KWARG_VARS+=("${KWARG_ARRAY[i]}")
    done

    for i in $(seq $((${#KWARG_ARRAY[@]} / 2)) $((${#KWARG_ARRAY[@]} - 1)));
    do
        KWARG_KEYS+=("${KWARG_ARRAY[i]}")
    done

    for i in $(seq 0 ${#KWARG_VARS[@]});
    do
        args.kwargs.get "${KWARG_VARS[i]}" "${KWARG_KEYS[i]}"
    done
}