#!/bin/bash

source bin/conf
source bin/libs/args
source bin/libs/inputs
source bin/libs/secure

packages.mysql.run() {
    while true;
    do
        CHOICES=(
            "Docker"
        )

        VALUES=(
            docker
        )

        args.pull RUN
        inputs.choices RUN "Run MySQL" "Choose running method" "docker" "$RUN" "${CHOICES[@]}" "${VALUES[@]}"

        if [[ $RUN == "docker" ]]; then
            packages.mysql.run.docker
        elif [[ $RUN == "cancel" ]]; then
            return
        fi
    done
}

packages.mysql.run.docker() {
    secure.password.master
    manage.conf.secure.load "conf/$UWKGM_ENV.secrets.enc"

    sudo docker run \
        --name uwkgm-mysql \
        -p "3306:$UWKGM_DB_DJANGO_PORT" -p 33060:33060 \
        -e MYSQL_ROOT_PASSWORD="$UWKGM_DB_DJANGO_ROOT_PASSWORD" \
        -e MYSQL_DATABASE=UWKGM \
        -e bind_address=0.0.0.0 \
        -v "$UWKGM_DB_DJANGO_HOST_PATH:/var/lib/mysql" \
        -d mysql:8

    echo ""
    echo "[UWKGM: INFO] Executed Docker's run command"
    echo ""
}