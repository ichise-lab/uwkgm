#!/bin/bash

source bin/conf
source bin/libs/args
source bin/libs/inputs
source bin/libs/secure
source conf/databases

packages.mongo.run() {
    while true;
    do
        CHOICES=(
            "Docker"
        )

        VALUES=(
            docker
        )

        args.pull RUN
        inputs.choices RUN "Run MongoDB" "Choose running method" "docker" "$RUN" "${CHOICES[@]}" "${VALUES[@]}"

        if [[ $RUN == "docker" ]]; then
            packages.mongo.run.docker
        elif [[ $RUN == "cancel" ]]; then
            return
        fi
    done
}

packages.mongo.run.docker() {
    secure.password.master
    manage.conf.secure.load "conf/$UWKGM_ENV.secrets.enc"

    sudo docker run \
        --name uwkgm-mongo \
        -p "27017:$UWKGM_DB_DOCS_PORT" \
        -e "MONGO_INITDB_ROOT_USERNAME=$UWKGM_DB_DOCS_USERNAME" \
        -e "MONGO_INITDB_ROOT_PASSWORD=$UWKGM_DB_DOCS_PASSWORD" \
        -v "$UWKGM_DB_DOCS_HOST_PATH:/data/db" \
        -d mongo:4 \
        --bind_ip 0.0.0.0 \
        --auth
    
    echo ""
    echo "[UWKGM: INFO] Executed Docker's run command"
    echo ""
}
